---
title: Hosting di ASP.NET Core SignalR produzione e la scalabilità
author: bradygaster
description: Informazioni su come evitare le prestazioni e scalabilità problemi nelle App che usano ASP.NET Core SignalR.
monikerRange: '>= aspnetcore-2.1'
ms.author: bradyg
ms.custom: mvc
ms.date: 11/28/2018
uid: signalr/scale
ms.openlocfilehash: 4ac4509acc89d0091a3757c7cfbc9981614f29ad
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/01/2019
ms.locfileid: "57037738"
---
# <a name="aspnet-core-signalr-hosting-and-scaling"></a><span data-ttu-id="fd7cc-103">ASP.NET Core SignalR hosting e scalabilità</span><span class="sxs-lookup"><span data-stu-id="fd7cc-103">ASP.NET Core SignalR hosting and scaling</span></span>

<span data-ttu-id="fd7cc-104">Dal [Andrew Stanton-Nurse](https://twitter.com/anurse), [Brady Gaster](https://twitter.com/bradygaster), e [Tom Dykstra](https://github.com/tdykstra),</span><span class="sxs-lookup"><span data-stu-id="fd7cc-104">By [Andrew Stanton-Nurse](https://twitter.com/anurse), [Brady Gaster](https://twitter.com/bradygaster), and [Tom Dykstra](https://github.com/tdykstra),</span></span>

<span data-ttu-id="fd7cc-105">Questo articolo illustra l'hosting e scalabilità considerazioni per le app a traffico elevato che usano ASP.NET Core SignalR.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-105">This article explains hosting and scaling considerations for high-traffic apps that use ASP.NET Core SignalR.</span></span>

## <a name="tcp-connection-resources"></a><span data-ttu-id="fd7cc-106">Risorse di connessione TCP</span><span class="sxs-lookup"><span data-stu-id="fd7cc-106">TCP connection resources</span></span>

<span data-ttu-id="fd7cc-107">Il numero di connessioni TCP simultanee che possa supportare un server web è limitato.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-107">The number of concurrent TCP connections that a web server can support is limited.</span></span> <span data-ttu-id="fd7cc-108">I client HTTP standard usano *temporanee* connessioni.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-108">Standard HTTP clients use *ephemeral* connections.</span></span> <span data-ttu-id="fd7cc-109">Queste connessioni possono essere chiusa quando il client diventa inattivo e riaperti in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-109">These connections can be closed when the client goes idle and reopened later.</span></span> <span data-ttu-id="fd7cc-110">D'altra parte, è una connessione SignalR *permanente*.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-110">On the other hand, a SignalR connection is *persistent*.</span></span> <span data-ttu-id="fd7cc-111">Le connessioni SignalR rimangono aperti anche quando il client diventa inattivo.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-111">SignalR connections stay open even when the client goes idle.</span></span> <span data-ttu-id="fd7cc-112">In un'app a traffico elevato che gestisce molti client, queste connessioni permanenti possono causare i server da sottoporre a hit il numero massimo di connessioni.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-112">In a high-traffic app that serves many clients, these persistent connections can cause servers to hit their maximum number of connections.</span></span>

<span data-ttu-id="fd7cc-113">Le connessioni persistenti anche utilizzano ulteriore memoria, per tenere traccia di ogni connessione.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-113">Persistent connections also consume some additional memory, to track each connection.</span></span>

<span data-ttu-id="fd7cc-114">L'uso eccessivo delle risorse correlate alla connessione da SignalR può influire sulle altre App web ospitate nello stesso server.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-114">The heavy use of connection-related resources by SignalR can affect other web apps that are hosted on the same server.</span></span> <span data-ttu-id="fd7cc-115">Quando SignalR apre e mantiene l'ultimo connessioni TCP disponibili, altre App web nello stesso server non dispone anche più disponibili a tali connessioni.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-115">When SignalR opens and holds the last available TCP connections, other web apps on the same server also have no more connections available to them.</span></span>

<span data-ttu-id="fd7cc-116">Se un server esaurisce le connessioni, si noterà che gli errori di socket casuale e connessione Reimposta gli errori.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-116">If a server runs out of connections, you'll see random socket errors and connection reset errors.</span></span> <span data-ttu-id="fd7cc-117">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="fd7cc-117">For example:</span></span>

```
An attempt was made to access a socket in a way forbidden by its access permissions...
```

<span data-ttu-id="fd7cc-118">Per evitare l'utilizzo delle risorse di SignalR causando errori in altre App web, eseguire SignalR su server diversi da altre App web.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-118">To keep SignalR resource usage from causing errors in other web apps, run SignalR on different servers than your other web apps.</span></span>

<span data-ttu-id="fd7cc-119">Per evitare l'utilizzo delle risorse di SignalR causando errori in un'app di SignalR, per limitare il numero di connessioni di che deve gestire un server scalabilità orizzontale.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-119">To keep SignalR resource usage from causing errors in a SignalR app, scale out to limit the number of connections a server has to handle.</span></span>

## <a name="scale-out"></a><span data-ttu-id="fd7cc-120">Scalare in orizzontale</span><span class="sxs-lookup"><span data-stu-id="fd7cc-120">Scale out</span></span>

<span data-ttu-id="fd7cc-121">Un'app che usa SignalR deve tenere traccia di tutte le connessioni, che crea problemi per una server farm.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-121">An app that uses SignalR needs to keep track of all its connections, which creates problems for a server farm.</span></span> <span data-ttu-id="fd7cc-122">Aggiungere un server e ottiene nuove connessioni che non conoscono gli altri server.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-122">Add a server, and it gets new connections that the other servers don't know about.</span></span> <span data-ttu-id="fd7cc-123">Ad esempio, non è a conoscenza delle connessioni in altri server di SignalR in ogni server nel diagramma seguente.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-123">For example, SignalR on each server in the following diagram is unaware of the connections on the other servers.</span></span> <span data-ttu-id="fd7cc-124">Quando si vuole inviare un messaggio a tutti i client SignalR su uno dei server, il messaggio viene inserito solo i client connessi a tale server.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-124">When SignalR on one of the servers wants to send a message to all clients, the message only goes to the clients connected to that server.</span></span>

![La scalabilità senza un backplane SignalR](scale/_static/scale-no-backplane.png)

<span data-ttu-id="fd7cc-126">Le opzioni per risolvere questo problema sono le [servizio Azure SignalR](#azure-signalr-service) e [Redis backplane](#redis-backplane).</span><span class="sxs-lookup"><span data-stu-id="fd7cc-126">The options for solving this problem are the [Azure SignalR Service](#azure-signalr-service) and [Redis backplane](#redis-backplane).</span></span>

## <a name="azure-signalr-service"></a><span data-ttu-id="fd7cc-127">Servizio Azure SignalR</span><span class="sxs-lookup"><span data-stu-id="fd7cc-127">Azure SignalR Service</span></span>

<span data-ttu-id="fd7cc-128">Il servizio Azure SignalR è un proxy anziché un backplane.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-128">The Azure SignalR Service is a proxy rather than a backplane.</span></span> <span data-ttu-id="fd7cc-129">Ogni volta che un client avvia una connessione al server, viene reindirizzato il client per connettersi al servizio.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-129">Each time a client initiates a connection to the server, the client is redirected to connect to the service.</span></span> <span data-ttu-id="fd7cc-130">Tale processo è illustrato nel diagramma seguente:</span><span class="sxs-lookup"><span data-stu-id="fd7cc-130">That process is illustrated in the following diagram:</span></span>

![Stabilire una connessione al servizio Azure SignalR](scale/_static/azure-signalr-service-one-connection.png)

<span data-ttu-id="fd7cc-132">Il risultato è che il servizio gestisce tutte le connessioni client, mentre ogni server necessita solo un piccolo numero costante di connessioni al servizio, come illustrato nel diagramma seguente:</span><span class="sxs-lookup"><span data-stu-id="fd7cc-132">The result is that the service manages all of the client connections, while each server needs only a small constant number of connections to the service, as shown in the following diagram:</span></span>

![Client connessi al servizio, i server connessi al servizio](scale/_static/azure-signalr-service-multiple-connections.png)

<span data-ttu-id="fd7cc-134">Questo approccio per la scalabilità presenta diversi vantaggi rispetto l'alternativa di backplane Redis:</span><span class="sxs-lookup"><span data-stu-id="fd7cc-134">This approach to scale-out has several advantages over the Redis backplane alternative:</span></span>

* <span data-ttu-id="fd7cc-135">Le sessioni permanenti, note anche come [affinità del client](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), non è necessaria perché i client vengono immediatamente reindirizzati al servizio Azure SignalR al momento della connessione.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-135">Sticky sessions, also known as [client affinity](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), is not required, because clients are immediately redirected to the Azure SignalR Service when they connect.</span></span>
* <span data-ttu-id="fd7cc-136">Un'app consente la scalabilità orizzontale di SignalR in base al numero di messaggi inviati, mentre il servizio Azure SignalR ridimensiona automaticamente per gestire un numero qualsiasi di connessioni.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-136">A SignalR app can scale out based on the number of messages sent, while the Azure SignalR Service automatically scales to handle any number of connections.</span></span> <span data-ttu-id="fd7cc-137">Ad esempio, potrebbe essere presenti migliaia di client, ma se solo alcuni messaggi al secondo inviati, l'app SignalR non sarà necessario scalare orizzontalmente su più server per gestire le connessioni a se stessi.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-137">For example, there could be thousands of clients, but if only a few messages per second are sent, the SignalR app won't need to scale out to multiple servers just to handle the connections themselves.</span></span>
* <span data-ttu-id="fd7cc-138">Un'app di SignalR non verrà usate molte più risorse di connessione di un'app web senza SignalR.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-138">A SignalR app won't use significantly more connection resources than a web app without SignalR.</span></span>

<span data-ttu-id="fd7cc-139">Per questi motivi, è consigliabile il servizio Azure SignalR per tutte le app ASP.NET Core SignalR ospitate in Azure, tra cui servizio App, le macchine virtuali e contenitori.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-139">For these reasons, we recommend the Azure SignalR Service for all ASP.NET Core SignalR apps hosted on Azure, including App Service, VMs, and containers.</span></span>

<span data-ttu-id="fd7cc-140">Per altre informazioni vedere la [documentazione del servizio Azure SignalR](/azure/azure-signalr/signalr-overview).</span><span class="sxs-lookup"><span data-stu-id="fd7cc-140">For more information see the [Azure SignalR Service documentation](/azure/azure-signalr/signalr-overview).</span></span>

## <a name="redis-backplane"></a><span data-ttu-id="fd7cc-141">Backplane Redis</span><span class="sxs-lookup"><span data-stu-id="fd7cc-141">Redis backplane</span></span>

<span data-ttu-id="fd7cc-142">[Redis](https://redis.io/) è un archivio chiave-valore in memoria che supporta un sistema di messaggistica con un modello publish/subscribe.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-142">[Redis](https://redis.io/) is an in-memory key-value store that supports a messaging system with a publish/subscribe model.</span></span> <span data-ttu-id="fd7cc-143">Backplane SignalR Redis Usa la funzionalità di pubblicazione/sottoscrizione per inoltrare i messaggi ad altri server.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-143">The SignalR Redis backplane uses the pub/sub feature to forward messages to other servers.</span></span> <span data-ttu-id="fd7cc-144">Quando un client stabilisce una connessione, le informazioni di connessione viene passate al backplane.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-144">When a client makes a connection, the connection information is passed to the backplane.</span></span> <span data-ttu-id="fd7cc-145">Quando un server vuole inviare un messaggio a tutti i client, invia al backplane.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-145">When a server wants to send a message to all clients, it sends to the backplane.</span></span> <span data-ttu-id="fd7cc-146">Backplane SA connesse tutte le soluzioni client e che i server si trovano nella.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-146">The backplane knows all connected clients and which servers they're on.</span></span> <span data-ttu-id="fd7cc-147">Invia il messaggio a tutti i client tramite le rispettive istanze server.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-147">It sends the message to all clients via their respective servers.</span></span> <span data-ttu-id="fd7cc-148">Questo processo è illustrato nel diagramma seguente:</span><span class="sxs-lookup"><span data-stu-id="fd7cc-148">This process is illustrated in the following diagram:</span></span>

![Backplane, messaggio inviato da un server a tutti i client redis](scale/_static/redis-backplane.png)

<span data-ttu-id="fd7cc-150">Backplane Redis è l'approccio di scalabilità orizzontale consigliata per le app ospitate nella propria infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-150">The Redis backplane is the recommended scale-out approach for apps hosted on your own infrastructure.</span></span> <span data-ttu-id="fd7cc-151">Azure SignalR Service non è un'opzione possibile per la produzione con le App in locale a causa di latenza della connessione tra il data center e un data center di Azure.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-151">Azure SignalR Service isn't a practical option for production use with on-premises apps due to connection latency between your data center and an Azure data center.</span></span>

<span data-ttu-id="fd7cc-152">I vantaggi del servizio Azure SignalR indicati in precedenza sono gli svantaggi per il backplane di Redis:</span><span class="sxs-lookup"><span data-stu-id="fd7cc-152">The Azure SignalR Service advantages noted earlier are disadvantages for the Redis backplane:</span></span>

* <span data-ttu-id="fd7cc-153">Le sessioni permanenti, note anche come [affinità del client](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), è necessario.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-153">Sticky sessions, also known as [client affinity](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), is required.</span></span> <span data-ttu-id="fd7cc-154">Una volta che viene avviata una connessione in un server, la connessione deve rimanere in tale server.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-154">Once a connection is initiated on a server, the connection has to stay on that server.</span></span>
* <span data-ttu-id="fd7cc-155">Un'app di SignalR è necessario scalare orizzontalmente basata sul numero di client anche se alcuni messaggi vengono inviati.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-155">A SignalR app must scale out based on number of clients even if few messages are being sent.</span></span>
* <span data-ttu-id="fd7cc-156">Un'app di SignalR utilizza molte più risorse di connessione di un'app web senza SignalR.</span><span class="sxs-lookup"><span data-stu-id="fd7cc-156">A SignalR app uses significantly more connection resources than a web app without SignalR.</span></span>

## <a name="next-steps"></a><span data-ttu-id="fd7cc-157">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="fd7cc-157">Next steps</span></span>

<span data-ttu-id="fd7cc-158">Per altre informazioni, vedere le seguenti risorse:</span><span class="sxs-lookup"><span data-stu-id="fd7cc-158">For more information, see the following resources:</span></span>

* [<span data-ttu-id="fd7cc-159">Documentazione di Azure SignalR Service</span><span class="sxs-lookup"><span data-stu-id="fd7cc-159">Azure SignalR Service documentation</span></span>](/azure/azure-signalr/signalr-overview)
* [<span data-ttu-id="fd7cc-160">Configurare un backplane di Redis</span><span class="sxs-lookup"><span data-stu-id="fd7cc-160">Set up a Redis backplane</span></span>](xref:signalr/redis-backplane)
